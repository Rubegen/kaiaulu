---
title: "Identity Showcase"
output: 
  html_document:
    toc: true
    number_sections: true
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Identity Showcase}
  %\VignetteEncoding{UTF-8}
---

```{r}
rm(list = ls())
seed <- 1
set.seed(seed)
```

```{r warning=FALSE,message=FALSE}
require(kaiaulu)
require(data.table)
require(stringi)
require(igraph)
require(knitr)
require(visNetwork)
```

Load config file.

```{r}
tool <- yaml::read_yaml("../tools.yml")
conf <- yaml::read_yaml("../conf/apr.yml")
perceval_path <- tool[["perceval"]]
git_repo_path <- conf[["data_path"]][["git"]]
mbox_path <- conf[["data_path"]][["mbox"]]
```


Obtain edgelist 

```{r}
project_git <- parse_gitlog(perceval_path,git_repo_path)
project_mbox <- parse_mbox(perceval_path,mbox_path)
```

Specify the commit interval of interest

```{r}
start_commit <- "9eae9e96f15e1f216162810cef4271a439a74223"
end_commit <- "f1d2d568776b3708dd6a3077376e2331f9268b04"

interval_timestamps <- project_git[data.commit %in% c(start_commit,end_commit)]$data.AuthorDate
start_date <- interval_timestamps[1]
end_date <- interval_timestamps[2]

project_git <- project_git[data.AuthorDate >= start_date & data.AuthorDate <= end_date]
project_mbox <- project_mbox[data.Date >= start_date & data.Date <= end_date]
```

Parse networks edgelist from extracted data

```{r}
project_git <- parse_gitlog_network(project_git,mode="author")
project_mbox <- parse_mbox_network(project_mbox)
```

Assign common identity (id) to both networks authors

```{r}
projects <- assign_network_identity(project_git,project_mbox,assign_exact_identity)
project_git <- projects[["project_git"]]
project_mbox <- projects[["project_mbox"]]
```


Load networks in igraph

```{r}
git_network <- igraph::graph_from_data_frame(d=project_git[["edgelist"]], 
                      directed = TRUE, 
                      vertices = project_git[["nodes"]])
mbox_network <- igraph::graph_from_data_frame(d=project_mbox[["edgelist"]], 
                      directed = TRUE, 
                      vertices = project_mbox[["nodes"]])
```



We can also obtain the projection networks of dev-thread => dev-dev, and dev-file => dev-dev.

```{r}
git_network_authors <- igraph::bipartite_projection(git_network,
                                          multiplicity = TRUE,
                                          which = TRUE) # FALSE is the thread projection

mbox_network_authors <- igraph::bipartite_projection(mbox_network,
                                          multiplicity = TRUE,
                                          which = TRUE) # FALSE is the thread projection
```


# Identity Manual Evaluation 

We can also export the table of authors for manual inspection to see how the identity algorithm did matching people. The table is omitted in the public vignette due for privacy of the participants in the open source project.

```{r}
knitr::kable(project_mbox[["nodes"]][suppressWarnings(!is.na(as.numeric(id))),
                                     .(id,raw_name)])
```

# Networks after Identity Mapping

```{r}
visNetwork::visIgraph(git_network,randomSeed = 1)
```


```{r}
visIgraph(git_network_authors,randomSeed = 1)
```



```{r}
visIgraph(mbox_network,randomSeed = 1)
```

```{r}
visIgraph(mbox_network_authors,randomSeed = 1)
```

